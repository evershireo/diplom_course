# Linux глазами инженера

Как говорилось ранее, сам по себе Linux -- ядро, а не операционная система. Операционной системой принято называть ядро Linux + некоторый набор програм, хотя в сообществе Linux чаще встречается слово "дистрибьютив". Не смотря на то, что набор программ будет разным в зависимости от дистрибьютива, в большинстве дистрибьютивов присутствуют базовые утилиты для работы с системой. В данной главе будут рассмотрены базовые утилиты командой строки, их применение, синтаксис и интересные кейсы.

![alt text](../images/chapter3/image.png)

## А что с графическим интерфейсом?

Он есть, и его очень много. У Linux очень много возможностей для кастомизации графического интерфейса: можно сделать интерфейс похожим на Windows, или наоборот, не похожим ни на что. С ОС на базе ядра Linux можно полноценно работать через графический интерфейс, в том числе, выполнять задачи администрирования. Но чаще всего инженеры выбирают командную строку, так как:

- Это быстро. Чаще всего, написать одну команду быстрее, чем искать нужную кнопку в графическом интерфейсе.
- Это воспроизводимо. Можно написать несколько комманд по порядку в текстовый файл и запускать этот текстовый файл. Такой подход называется скриптинг, а текстовый файл с командами называется скрипт. При помощи скриптов можно автоматизировать большингство рутинных операций.
- Это дает больше информации. В выводе команды, чаще всего, содержится большее количество полезной информации, чем в графическом интерфейсе.
- Графическому интерфейсу необходимы ресурсы. Любой графический интерфейс будет потреблять дополнительные ресурсы, такие как оперативная память, процессорное время, место на жестком диске. Это не допустимо на серверах в высоконагруженных проектах.

Раньше считалось, что для работы с Linux так или иначе придется лазить в терминал и писать команды, но в современном мире это уже давно не так. Linux позволяет полноценно работать через графический интерфейс и обычному пользователю не придется открывать терминал. Тем не менее, большинство задач удобнее и быстрее решать через командную строку.

## Основы работы в командной строке

Команды в Linux представляют из себя самые обычные приложения, написанные на языке программирования C/C++ или Python. У любой команды есть свой исходный код, в который можно внести изменения и внедрить их в свою систему. Команды чаще всего распологаются в директориях `/bin`, `/usr/bin`, `/sbin`, `/usr/sbin`. Посмотреть все директории с командами можно при помощи

```bash
echo $PATH
```

Команды в Linux делятся на несколько основных групп, вне зависимости от дистрибьютива

1. Команды для работы с файловой системой
    - `cd` (change directory) – изменяет текущую директорию.
    - `ls` (list) – отображает содержимое каталога.
    - `pwd` (print working directory) – показывает путь к текущей директории.
    - `mkdir` (make directory) – создает новый каталог.
    - `rmdir` (remove directory) – удаляет пустой каталог.
    - `rm` (remove) – удаляет файлы и папки. Для удаления директорий используется опция `-r`.
    - `cp` (copy) – копирует файлы и каталоги.
    - `mv` (move) – перемещает или переименовывает файлы и каталоги.
    - `touch` – создает пустой файл или обновляет время последнего изменения для существующего файла.

2. Команды для управления пользователями и группами
    - `useradd` – добавляет нового пользователя.
    - `usermod` – изменяет параметры существующего пользователя.
    - `userdel` – удаляет пользователя.
    - `groupadd` – создает новую группу.
    - `groupdel` – удаляет группу.
    - `passwd` – позволяет изменить пароль пользователя.

3. Команды для работы с процессами
    - `ps` – отображает список работающих процессов.
    - `top` – динамически показывает список процессов в реальном времени.
    - `kill` – отправляет сигнал процессу (обычно для его завершения).
    - `killall` – завершает все процессы с заданным именем.
    - `nice/renice` – изменяет приоритет процесса.

4. Команды для работы с сетью
    - `ping` – проверяет доступность хоста в сети.
    - `ifconfig` / `ip` – отображает или изменяет параметры сетевых интерфейсов.
    - `netstat` – показывает статистику сети и состояние соединений.
    - `ssh` – позволяет подключаться к удалённой машине через защищённый канал.
    - `scp` – безопасно копирует файлы между хостами.

5. Команды для работы с текстом
    - `cat` – выводит содержимое файлов.
    - `echo` – выводит строку текста или значение переменной.
    - `grep` – ищет текст по заданному шаблону.
    - `awk` – мощная утилита для обработки и анализа текстовых данных.
    - `sed` – потоковый редактор для обработки текста.

6. Команды для архивирования и сжатия
    - `tar` – создает и извлекает архивы. Используется с опциями, такими как `-cvf` для создания и `-xvf` для извлечения.
    - `gzip/gunzip` – сжимает и распаковывает файлы.
    - `zip/unzip` – архивирует и разархивирует файлы в формате ZIP.

7. Команды для управления системой
    - `shutdown` – завершает работу или перезагружает систему.
    - `reboot` – перезагружает систему.
    - `systemctl` – управляет службами в системах с Systemd.
    - `service` – управляет системными службами.

У командной строки также есть элемент, называемый "приглашение". Чаще всего в приглашении указано имя текущего пользователя + имя компьютера и уровень привелегий. Чаще всего пришлашение выглядит следующим образом

```bash
user@pc1$ 
```

Здесь:

- `user` -- имя пользователя, под которым произведен вход в систему
- `pc1` -- имя компьютера (хостнейм)
- `$` или `#` -- Уровень привилегий. Символ $ обозначает уровень привилегий пользователя, символ # обозначает максимальный уровень привилегий.

Большинство команд в Linux работают следующим образом: сначала пишется команда, затем дополнительные опции (ключи) и аргументы. Например

```bash
ls        -al      /home/user
^          ^          ^
Команда    Ключи      Аргумент
```

Аргументов, как и ключей может быть несколько. Комбинируя их, можно получить разный результат. Для того, чтобы ознакомится с синтаксисом команды чаще всего можно написать название команды с ключом `-h` или `--help`, например

```bash
ls -h
ls --help
```

Дадут одинаковый результат -- выведут справку по использованию команды `ls`

Стиль написания ключей также имеет значение. Например, команда

```bash
ls --help
```

Будет интерпритирована как команда `ls` с ключем `--help`, но если написать

```bash
ls -help
```

То это будет интерпритировано как

```bash
ls -h -e -l -p
```

Для примера рассмотрим базовые команды работы с файловой системой

Для перемещения по файловой системе используется команда `cd`, для вывода на экран текущего каталога используется команда `pwd`.

```bash
$ cd /usr/share/lib/etc/bin    Куда бы ты ни пошел
$ pwd
/usr/share/lib/etc/bin    ...ты здесь.
```

Где бы вы не находились в файловой системе на текущий момент, команда `cd` позволяет перейти куда-то еще. В качестве аргумента команда `cd` принимает полный или относительный путь в файловой системе, например

```bash
$ pwd
/home/user/
$ cd /home/user/Desktop #Переход по полному пути
$ cd Desktop #Переход по относительному пути
```

Полным путем в файловой системе называется путь, который начинается от корня (символ `/`) файловой системы и продолжается до конечной директории.

Относительный путь — это путь, который указывает местоположение относительно текущего рабочего каталога. Представьте, что вы сейчас находитесь в папке `/home/user`. В этой папке есть еще одна папка под названием `Desktop`. Чтобы перейти в папку `Desktop`, нет необходимости указывать полный путь, как, например, `/home/user/Desktop`. Вместо этого вы можете просто использовать относительный путь и набрать `cd Desktop`, чтобы переместиться в нужную папку.

Что если написать команду `cd` без аргументов? Вызовется стандратное поведение команды. Для `cd` это перемещение в домашний каталог.

```bash
$ pwd
/usr/share/
$ cd
$ pwd
/home/user
```

У каждой команды предусмотрено свое стандартное поведение. Чаще всего, это вывод справки по использованию команды.

Кроме того, в командной строке Linux существует автодополнение. Чаще всего, автодополнение работает по умолчанию по нажатию клавиши `Tab`, но в зависимости от дистрибьютива и используемой оболочки может отличаться.å

Например, чтобы не писать команду `cd Desktop` полностью, можно воспользоваться автодополнением

```bash
$ cd Desk<Tab>
$ cd Desktop
```

Автозавершение командной строки подходит не только для команд cd. Оно работает для большинства команд, хотя его поведение может отличаться. С командой cd клавиша Tab завершает имена каталогов. Для команд, работающих с файлами, таких как cat, grep и sort, автозавершение дополняет имена файлов. Если используется команда ssh (secure shell), Tab дополняет имена хостов. Для команды chown (изменить владельца файла) она дополняет имена пользователей.

Кроме того, стоит отметить, что командная строка Linux позволяет использовать маски. Маска — это набор символов, который используется для обозначения группы файлов или каталогов, соответствующих определённому шаблону. Маски помогают упростить работу с файлами, когда вам нужно выбрать несколько объектов с общими характеристиками. Например, маска `*.txt` выберет все файлы с расширением `.txt` в текущем каталоге. Символ `*` представляет собой любое количество любых символов, а символ `?` может использоваться для обозначения одного любого символа. Эти маски облегчают выполнение операций над группами файлов или папок, таких как копирование, перемещение или удаление.

```bash
$ ls *.txt
foo.txt bar.txt 1.txt 2.txt 3.txt

$ ls ?.txt
1.txt 2.txt 3.txt

$ ls ???.txt
foo.txt bar.txt
```

## Скриптинг

Допустим, нам необходимо раз в неделю очищать три рабочих директории: app_cache, Downloads, Desktop. Чтобы это делать, мы открываем терминал и пишем

```bash
rm -rf /home/user/Downloads/*
rm -rf /home/user/app_cache/*
rm -rf /home/user/Desktop/*
```

Для того, чтобы не вводить одни и те же команды, можно написать скрипт. Скрипт будет выглядеть как текстовый файл, с поочередным набором комманд, которые мы вводим с клавиатуры

```bash
$ cat clean.sh
#!/bin/bash                     #Shebang
rm -rf /home/user/Downloads/*   #Команда 1
rm -rf /home/user/app_cache/*   #Команда 2
rm -rf /home/user/Desktop/*     #Команда 3
```

Таким образом можно автоматизировать любую последовательность действий, просто вписав команды в порядке очереди, но что же такое Shebang?

Шебанг (она же "shebang" или "hashbang") — это последовательность символов, помещённая в начале скриптовых файлов Unix-подобных систем, которая указывает системе, какую программу использовать для интерпретации содержимого файла. Шебанг начинается с символов #! за которыми следует путь к интерпретатору.

Например, в скрипте на языке Python шебанг может выглядеть так:

```bash
#!/usr/bin/env python3
```

Эта строка указывает системе, что для выполнения скрипта следует использовать интерпретатор Python 3. `#!/usr/bin/env python3` полезно использовать, так как это работает независимо от точного местоположения Python 3 в системе. Команда env ищет интерпретатор в пути, указанном в переменной окружения PATH.

В случае скриптов на других языках, таких как Bash, Perl или Ruby, путь к соответствующему интерпретатору будет указан после `#!`. Например:

- Для Bash-скриптов: `#!/bin/bash`
- Для Perl-скриптов: `#!/usr/bin/perl`

Шебанг не является обязательным в скриптах, которые запускаются непосредственно через соответствующий интерпретатор (например, `python3 script.py`), но он необходим для автономного выполнения скрипта как исполняемого файла (например, `./script.py`).

После того, как скрипт написан, можно попробовать его запустить

```bash
/home/user/clean.sh

# Или, находясь в /home/user/

./clean.sh
```

И получить ошибку отсутствия прав на выполнение. Дело в том, что Linux -- безопасная система и на каждом файле по умолчанию присутствует минимально необходимый набор прав. Для того, чтобы сделать скрипт исполняемым -- необходимо добавить к нему права на выполнение. Сделать это можно при помощи команды

```bash
chmod +x clean.sh
```

Данная команда добавит права на выполнение скрипта.
